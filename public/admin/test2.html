<!DOCTYPE html>
<html lang="zh_CN">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            padding: 10px;
        }
        
        .goods-cover:before {
            position: absolute;
            content: "商品封面";
            height: 40px;
            font-size: 14px;
            font-weight: bold;
            top: -30px;
            width: 100%;
            text-align: center;
            left: 0;
        }
        
        .img {
            position: absolute;
            width: 90%;
            top: 5%;
            left: 5%;
            height: 120px;
            /* background: red; */
            padding: 10px;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        
        .goods-cover {
            text-align: center;
            border-radius: 3px;
            border: 1px dashed #ccc;
            padding: 3px;
            position: absolute;
            width: 220px;
            height: 180px;
            top: 46px;
            right: 40px;
        }
        
        .file {
            position: absolute;
            display: inline-block;
            left: 0;
            width: 90%;
            height: 30px;
            background: #D0EEFF;
            border: 1px solid #99D3F5;
            border-radius: 4px;
            padding: 4px 12px;
            overflow: hidden;
            color: #1E88C7;
            text-decoration: none;
            text-indent: 0;
            line-height: 20px;
            bottom: 0;
            margin: 5%;
        }
        
        .file input {
            position: absolute;
            font-size: 10px;
            right: 0;
            top: 0;
            opacity: 0;
        }
        
        .file:hover {
            background: #AADFFD;
            border-color: #78C3F3;
            color: #004974;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div id="app">
        <ol class="breadcrumb">
            <li><a href="test1.html">商品管理</a></li>
        </ol>
        <p class="bg-default clearfix">
            <button class="btn btn-primary pull-right" @click="addClassify()">添加商品</button>
        </p>
        <div class="table-responsive">
            <table class="table table-hover table-bordered">
                <tr>
                    <th>ID</th>
                    <th>商品名称</th>
                    <th>商品备注</th>
                    <th>操作</th>
                </tr>
                <tr v-for="item in goodsList">
                    <td>{{item.id}}</td>
                    <td>{{item.name}}</td>
                    <td>{{item.remark}}</td>
                    <td style="text-align: center;width:200px;">
                        <button type="button" class="btn btn-primary btn-sm" @click="update(item)">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
						修改
					</button>
                        <button type="button" class="btn btn-danger btn-sm" @click="del(item.id)">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						删除
					</button>
                    </td>
                </tr>
            </table>
        </div>
        <!-- 添加商品 -->
        <div id="addClassify-template" style="display:none;padding:20px;padding-right:40px;position:relative;">
            <form id="form1" enctype="multipart/form-data" method="post" action="Upload.aspx"></form>
            <div class="goods-cover">
                <div class="img">
                    <img style="max-height:100%;max-width:100%;" :src="goods_cover" alt="...">
                </div>

                <a class="file">上传封面<span id="progressNumber"></span>
                    <input type="file" class="" name="fileToUpload" id="fileToUpload" onchange="fileSelected();" />
                </a>

            </div>
            </form>
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">商品分类</label>
                    <div class="col-sm-6">
                        <select class="form-control" v-model="classifyId" placeholder="选择商品所属分类">
                        	<option v-bind:value="item.id" v-for="item in classifyList">{{item.name}}</option>
						</select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">商品名称</label>
                    <div class="col-sm-6">
                        <input type="text" v-model="name" class="form-control" placeholder="商品名称">
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">商品总价</label>
                    <div class="col-sm-6">
                        <div class="input-group">
                            <div class="input-group-addon"><span class="glyphicon glyphicon-yen"></span></div>
                            <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">分期价格</label>
                    <div class="col-sm-6">
                        <div class="input-group">
                            <div class="input-group-addon"><span class="glyphicon glyphicon-yen"></span></span>
                            </div>
                            <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
                            <div class="input-group-addon">&nbsp;6期价格&nbsp;</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">分期价格</label>
                    <div class="col-sm-6">
                        <div class="input-group">
                            <div class="input-group-addon"><span class="glyphicon glyphicon-yen"></span></div>
                            <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
                            <div class="input-group-addon">12期价格</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">分期价格</label>
                    <div class="col-sm-6">
                        <div class="input-group">
                            <div class="input-group-addon"><span class="glyphicon glyphicon-yen"></span></div>
                            <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
                            <div class="input-group-addon">24期价格</div>
                        </div>

                    </div>
                </div>


                <div class="form-group">
                    <label for="inputPassword3" class="col-sm-2 control-label">商品备注</label>
                    <div class="col-sm-10">
                        <textarea type="text" v-model="remark" class="form-control" placeholder="商品备注"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">商品状态</label>
                    <div class="col-sm-6">
                        <label class="radio-inline">
  							<input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"> 显示
						</label>
                        <label class="radio-inline">
  							<input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2"> 隐藏
						</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">免手续费</label>
                    <div class="col-sm-6">
                        <label class="radio-inline">
  							<input type="radio" name="inlineRadioOptions1" id="inlineRadio1" value="option1"> 是
						</label>
                        <label class="radio-inline">
  							<input type="radio" name="inlineRadioOptions1" id="inlineRadio2" value="option2"> 否
						</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button v-if="action===''||action==='add'" class="btn btn-primary" @click.prevent="add()">添加</button>
                        <button v-if="action===''||action==='update'" class="btn btn-primary" @click.prevent="updateData()">修改</button>
                        <button class="btn btn-danger" @click.prevent="cancel()">取消</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/vue/2.5.15/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/layer/3.1.0/layer.js"></script>
    <script>
        // alert(localStorage.getItem('uid') + "  " + localStorage.getItem('token'));
        var mylayer = null;
        let vm = new Vue({
            el: "#app",
            data: function() {
                return {
                    goodsList: [],
                    name: "",
                    goods_cover: "/admin/images/upload.png",
                    remark: "",
                    id: "",
                    state: "",
                    action: "",
                    classifyList: [], //所有分类
                    classifyId: "", //选中分类的id
                }
            },
            mounted: function() {
                queryAll(this);
            },
            methods: {
                addClassify: function() {
                    this.$nextTick(function() {
                        mylayer = layer.open({
                            title: "添加商品",
                            type: 1,
                            closeBtn: 1, //不显示关闭按钮
                            anim: 2,
                            area: ['800px', '600px'], //宽高
                            shade: false,
                            shadeClose: true, //开启遮罩关闭
                            content: $("#addClassify-template")
                        });
                        this.action = "add";
                    })

                },
                add: function(e) {
                    alert(this.classifyId)

                    //添加商品
                    var data = {
                        "name": this.name,
                        "remark": this.remark
                    }
                    addApi(data);

                },
                cancel: function() {
                    layer.close(mylayer);
                },
                del: function(id) {
                    alert(id)
                },
                update: function(obj) {

                },
                updateData: function() {

                }
            }
        })

        function updateApi(data) {
            $.ajax({
                type: 'POST',
                url: "/classify/update",
                data: data,
                success: function(data) {
                    layer.msg("商品修改成功！！！")
                    layer.close(mylayer);
                },
                dataType: 'json'
            });
            queryAll(vm)
        }

        function queryAll(_this) {
            $.get('/classify/queryAll', function(result) {
                console.log(result)
                _this.classifyList = result.data;
                _this.classifyId = result.data[0].id;

            })
        }


        function addApi(data) {
            $.ajax({
                type: 'POST',
                url: "/classify/adds",
                data: data,
                success: function(data) {
                    layer.msg("商品添加成功！！！")
                    layer.close(mylayer);
                },
                dataType: 'json'
            });
        }



        $(".goods-cover").hover(function() {
                layer.tips('点击按钮上传文件', '#fileToUpload', {
                    tips: [1, '#666666'],
                    time: 3000
                });
            }, function() {
                // $("p").css("background-color", "pink");
            })
            /**
             *上传相关接口 
             **/

        function fileSelected() {
            var file = document.getElementById('fileToUpload').files[0];
            if (file) {
                var fileSize = 0;
                if (file.size > 1024 * 1024)
                    fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
                else
                    fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';
                // document.getElementById('fileName').innerHTML = 'Name: ' + file.name;
                // document.getElementById('fileSize').innerHTML = 'Size: ' + fileSize;
                // document.getElementById('fileType').innerHTML = 'Type: ' + file.type;
                uploadFile();
            }
        }

        function uploadFile() {
            var fd = new FormData();
            fd.append("fileToUpload", document.getElementById('fileToUpload').files[0]);
            var xhr = new XMLHttpRequest();
            xhr.upload.addEventListener("progress", uploadProgress, false);
            xhr.addEventListener("load", uploadComplete, false);
            xhr.addEventListener("error", uploadFailed, false);
            xhr.addEventListener("abort", uploadCanceled, false);
            xhr.open("POST", "/upload"); //修改成自己的接口
            xhr.send(fd);
        }

        function uploadProgress(evt) {
            // alert(Math.round(evt.loaded * 100 / evt.total))
            if (evt.lengthComputable) {
                var percentComplete = Math.round(evt.loaded * 100 / evt.total);
                document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '%';
            } else {
                document.getElementById('progressNumber').innerHTML = 'unable to compute';
            }
        }

        function uploadComplete(evt) {
            /* 服务器端返回响应时候触发event事件*/
            console.log(evt)
            var result = JSON.parse(evt.target.responseText);
            vm.goods_cover = result.path.replace("public", "")
            layer.msg("封面图片上传完成！")
        }

        function uploadFailed(evt) {
            alert("There was an error attempting to upload the file.");
        }

        function uploadCanceled(evt) {
            alert("The upload has been canceled by the user or the browser dropped the connection.");
        }
    </script>
</body>

</html>